syntax = "proto3";

package admin.v1;
option go_package = "github.com/yc-alpha/admin/api/admin/v1;v1";

import "google/api/annotations.proto";

// 租户管理服务
service TenantService {
  // 创建租户
  rpc CreateTenant (CreateTenantRequest) returns (CreateTenantResponse) {
    option (google.api.http) = {
      post: "/v1/tenants",
      body: "*"
    };
  }

  // 获取租户详情
  rpc GetTenant (GetTenantRequest) returns (GetTenantResponse) {
    option (google.api.http) = {
      get: "/v1/tenants/{id}"
    };
  }

  // 获取租户层级结构
  rpc GetTenantHierarchy (GetTenantHierarchyRequest) returns (GetTenantHierarchyResponse) {
    option (google.api.http) = {
      get: "/v1/tenants/{id}/hierarchy"
    };
  }

  // 获取根租户列表
  rpc ListRootTenants (ListRootTenantsRequest) returns (ListRootTenantsResponse) {
    option (google.api.http) = {
      get: "/v1/tenants/root"
    };
  }

  // 获取子租户列表
  rpc ListSubTenants (ListSubTenantsRequest) returns (ListSubTenantsResponse) {
    option (google.api.http) = {
      get: "/v1/tenants/{parent_id}/children"
    };
  }

  // 获取集团型租户列表
  rpc ListGroupTenants (ListGroupTenantsRequest) returns (ListGroupTenantsResponse) {
    option (google.api.http) = {
      get: "/v1/tenants/groups"
    };
  }

  // 获取租户统计信息
  rpc GetTenantStatistics (GetTenantStatisticsRequest) returns (GetTenantStatisticsResponse) {
    option (google.api.http) = {
      get: "/v1/tenants/statistics"
    };
  }

  // 更新租户
  rpc UpdateTenant (UpdateTenantRequest) returns (UpdateTenantResponse) {
    option (google.api.http) = {
      put: "/v1/tenants/{id}",
      body: "*"
    };
  }

  // 删除租户
  rpc DeleteTenant (DeleteTenantRequest) returns (DeleteTenantResponse) {
    option (google.api.http) = {
      delete: "/v1/tenants/{id}"
    };
  }
}

// 租户类型枚举
enum TenantType {
  NORMAL = 0;  // 普通租户
  GROUP = 1;   // 集团型租户
  SUB = 2;     // 子租户
}

// 租户状态枚举
enum TenantStatus {
  TENANT_PENDING = 0;
  TENANT_ACTIVE = 1;
  TENANT_DISABLED = 2;
  TENANT_EXPIRED = 3;
}

// 租户信息
message Tenant {
  string id = 1;
  string name = 2;
  string owner_id = 3;
  TenantType type = 4;
  string parent_id = 5;
  string path = 6;
  int32 level = 7;
  TenantStatus status = 8;
  string expired_at = 9;
  map<string, string> attributes = 10;
  string created_by = 11;
  string updated_by = 12;
  string created_at = 13;
  string updated_at = 14;
  bool deleted = 15;
  
  // 关联信息
  repeated Tenant children = 16;
  Tenant parent = 17;
}

// 创建租户请求
message CreateTenantRequest {
  string name = 1;
  string owner_id = 2;
  TenantType type = 3;
  string parent_id = 4;
  TenantStatus status = 5;
  string expired_at = 6;
  map<string, string> attributes = 7;
  string created_by = 8;
}

// 创建租户响应
message CreateTenantResponse {
  bool result = 1;
  int32 code = 2;
  string msg = 3;
  Tenant tenant = 4;
}

// 获取租户请求
message GetTenantRequest {
  string id = 1;
}

// 获取租户响应
message GetTenantResponse {
  bool result = 1;
  int32 code = 2;
  string msg = 3;
  Tenant tenant = 4;
}

// 获取租户层级请求
message GetTenantHierarchyRequest {
  string id = 1;
}

// 获取租户层级响应
message GetTenantHierarchyResponse {
  bool result = 1;
  int32 code = 2;
  string msg = 3;
  Tenant tenant = 4;
}

// 获取根租户列表请求
message ListRootTenantsRequest {
  int32 page = 1;
  int32 page_size = 2;
  string keyword = 3;
}

// 获取根租户列表响应
message ListRootTenantsResponse {
  bool result = 1;
  int32 code = 2;
  string msg = 3;
  repeated Tenant tenants = 4;
  int32 total = 5;
}

// 获取子租户列表请求
message ListSubTenantsRequest {
  string parent_id = 1;
  int32 page = 2;
  int32 page_size = 3;
  string keyword = 4;
}

// 获取子租户列表响应
message ListSubTenantsResponse {
  bool result = 1;
  int32 code = 2;
  string msg = 3;
  repeated Tenant tenants = 4;
  int32 total = 5;
}

// 获取集团型租户列表请求
message ListGroupTenantsRequest {
  int32 page = 1;
  int32 page_size = 2;
  string keyword = 3;
}

// 获取集团型租户列表响应
message ListGroupTenantsResponse {
  bool result = 1;
  int32 code = 2;
  string msg = 3;
  repeated Tenant tenants = 4;
  int32 total = 5;
}

// 获取租户统计请求
message GetTenantStatisticsRequest {
}

// 获取租户统计响应
message GetTenantStatisticsResponse {
  bool result = 1;
  int32 code = 2;
  string msg = 3;
  map<string, int32> statistics = 4;
}

// 更新租户请求
message UpdateTenantRequest {
  string id = 1;
  string name = 2;
  string owner_id = 3;
  TenantStatus status = 4;
  string expired_at = 5;
  map<string, string> attributes = 6;
  string updated_by = 7;
}

// 更新租户响应
message UpdateTenantResponse {
  bool result = 1;
  int32 code = 2;
  string msg = 3;
  Tenant tenant = 4;
}

// 删除租户请求
message DeleteTenantRequest {
  string id = 1;
}

// 删除租户响应
message DeleteTenantResponse {
  bool result = 1;
  int32 code = 2;
  string msg = 3;
}
